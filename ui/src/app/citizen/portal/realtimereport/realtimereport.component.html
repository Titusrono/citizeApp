<div class="max-w-7xl mx-auto">
  <h1 class="text-2xl md:text-3xl font-bold text-blue-600 mb-2">Real-Time Issue Reporting</h1>

  <!-- Intro Section -->
  <div class="bg-blue-50 border border-blue-200 text-blue-800 rounded-lg p-4 mb-6">
    <p class="text-base sm:text-lg mb-2">
      This page empowers citizens to report issues they encounter in their communities in real time.
    </p>
    <p class="text-sm text-blue-700">
      To report an issue:
      <br />
      - Click the <strong>Add Issue</strong> button to open the form.
      <br />
      - Describe the issue, set your location, pick a category, and provide image URLs.
      <br />
      - Submitted issues appear below and are visible to the public and authorities.
    </p>
  </div>

  <!-- Add Issue Button -->
  <div class="mb-6 flex justify-end">
    <button
      (click)="toggleForm()"
      class="bg-blue-600 text-white px-4 md:px-6 py-2 md:py-3 rounded-lg hover:bg-blue-700 transition font-medium text-sm md:text-base"
      [attr.aria-expanded]="showForm"
      aria-controls="issueForm"
    >
      {{ showForm ? '‚úñÔ∏è Hide Form' : '‚ûï Add Issue' }}
    </button>
  </div>

  <!-- Issue Submission Form -->
  <section *ngIf="showForm" id="issueForm" class="bg-white shadow-md rounded-lg p-6 mb-10">
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Report an Issue</h2>
    <form (submit)="onSubmit($event)">
      <!-- Description -->
      <div class="mb-4">
        <label class="block text-gray-700">Description</label>
        <textarea [(ngModel)]="formData.description" name="description" rows="4" required
          placeholder="Describe the issue..."
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"></textarea>
      </div>

      <!-- Location & Category -->
      <div class="mb-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-gray-700">Location</label>
          <div class="flex gap-2">
            <input [(ngModel)]="formData.location" name="location" type="text"
              placeholder="Enter location"
              class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" />
            <button type="button" (click)="fetchLocation()" title="Use My Location"
              class="bg-gray-200 hover:bg-gray-300 text-xs md:text-sm px-2 md:px-3 py-2 rounded whitespace-nowrap">
              üìç Use
            </button>
          </div>
        </div>
        <div>
          <label class="block text-gray-700">Category</label>
          <select [(ngModel)]="formData.category" name="category" required
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base">
            <option value="">Select Category</option>
            <option value="infrastructure">Infrastructure</option>
            <option value="public-safety">Public Safety</option>
            <option value="environment">Environment</option>
            <option value="other">Other</option>
          </select>
        </div>
      </div>

      <!-- Image URLs -->
      <div class="mb-4">
        <label class="block text-gray-700">Image URLs (comma-separated)</label>
        <input [(ngModel)]="formData.imageUrls" name="imageUrls" type="text"
          placeholder="https://example.com/image1.jpg, https://example.com/image2.jpg"
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" />
      </div>

      <!-- Submit Button -->
      <button type="submit"
        class="w-full md:w-auto bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-medium">
        ‚úÖ Submit Issue
      </button>
    </form>
  </section>

  <!-- ‚úÖ Popup -->
  <div id="popup"
    class="hidden fixed top-5 right-5 bg-green-100 text-green-700 border border-green-300 px-4 py-3 rounded-lg shadow-lg z-50 transition transform duration-300 ease-out">
    ‚úÖ Issue reported successfully!
  </div>

  <!-- Submitted Issues -->
  <section class="bg-gray-100 shadow-inner rounded-lg p-6">
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Submitted Issues</h2>

    <!-- Category Filter -->
    <div class="flex flex-wrap gap-3 mb-6">
      <button
        class="px-4 py-2 rounded-full border transition text-sm font-medium"
        [ngClass]="{ 
          'bg-blue-600 text-white border-blue-600': selectedCategory === '', 
          'bg-white text-gray-700 border-gray-300 hover:bg-gray-100': selectedCategory !== '' 
        }"
        (click)="selectedCategory = ''; currentPage = 1">
        All
      </button>
      <button
        *ngFor="let cat of ['infrastructure', 'public-safety', 'environment', 'other']"
        class="px-4 py-2 rounded-full border transition text-sm font-medium capitalize"
        [ngClass]="{ 
          'bg-blue-600 text-white border-blue-600': selectedCategory === cat, 
          'bg-white text-gray-700 border-gray-300 hover:bg-gray-100': selectedCategory !== cat 
        }"
        (click)="selectedCategory = cat; currentPage = 1">
        {{ cat.replace('-', ' ') }}
      </button>
    </div>

    <div *ngIf="filteredIssues.length === 0" class="text-gray-500">No issues found for this category.</div>

    <!-- Issue Cards -->
    <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3" *ngIf="filteredIssues.length > 0">
      <div *ngFor="let issue of paginatedIssues()"
        class="bg-white border border-gray-200 rounded-xl p-4 shadow-md hover:shadow-lg transition-all duration-300 space-y-4">
        <div class="text-blue-600 font-semibold text-sm uppercase tracking-wide">
          {{ issue.category.replace('-', ' ') }}
        </div>

        <!-- Image -->
        <div *ngIf="issue.images?.length" class="w-full h-44 overflow-hidden rounded-lg border border-gray-300 shadow-sm">
          <img [src]="issue.images[0]" class="w-full h-full object-cover" />
        </div>

        <!-- Date -->
        <div class="text-sm text-gray-400 italic">
          {{ issue.createdAt | date: 'medium' }}
        </div>

        <!-- Location -->
        <div class="text-sm text-gray-700">
          <span class="font-medium text-gray-800">Location:</span> {{ issue.location }}
        </div>

        <!-- Description -->
        <div>
          <div class="text-sm font-medium text-gray-800 mb-1">Description:</div>
          <p class="text-sm text-gray-700 leading-relaxed border p-3 rounded-md bg-gray-50">
            {{ issue.description }}
          </p>
        </div>

        <!-- More Images -->
        <div *ngIf="issue.images?.length > 1">
          <div class="text-sm font-medium text-gray-800 mb-2">More Images:</div>
          <div class="grid grid-cols-2 gap-3">
            <img *ngFor="let img of issue.images.slice(1)" [src]="img"
              class="w-full h-24 object-cover rounded-lg border" />
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="flex justify-between items-center mt-8" *ngIf="filteredIssues.length > 9">
      <button (click)="previousPage()" [disabled]="currentPage === 1"
        class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50">
        ‚Üê Previous
      </button>
      <span class="text-sm text-gray-600">Page {{ currentPage }} of {{ totalPages() }}</span>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages()"
        class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50">
        Next ‚Üí
      </button>
    </div>
  </section>
</div>
