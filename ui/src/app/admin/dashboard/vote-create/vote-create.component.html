<div class="max-w-5xl mx-auto">
  <h1 class="text-lg sm:text-xl md:text-2xl font-bold text-blue-700 mb-5 text-center tracking-tight">
    {{ editingProposal ? '✏️ Edit Voting Proposal' : '➕ Create New Voting Proposal' }}
  </h1>

  <form 
    (ngSubmit)="editingProposal ? updateProposal() : createProposal()" 
    #proposalForm="ngForm"
    class="bg-white border border-gray-200 rounded-lg shadow p-5 sm:p-6 space-y-5 text-sm"
  >
    <!-- Title -->
    <div>
      <label class="block text-gray-700 font-medium mb-1">Title</label>
      <input
        type="text"
        name="title"
        [(ngModel)]="proposal.title"
        required
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400"
        placeholder="Proposal title" />
    </div>

    <!-- Description -->
    <div>
      <label class="block text-gray-700 font-medium mb-1">Description</label>
      <textarea
        name="description"
        [(ngModel)]="proposal.description"
        rows="3"
        required
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400"
        placeholder="Brief description of the proposal"></textarea>
    </div>

    <!-- Eligibility -->
    <div>
      <label class="block text-gray-700 font-medium mb-1">Eligibility</label>
      <select
        name="eligibility"
        [(ngModel)]="proposal.eligibility"
        required
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400">
        <option value="" disabled selected>Select eligibility group</option>
        <option value="All Registered Residents">All Registered Residents</option>
        <!-- <option value="Registered Citizens">Registered Citizens Only</option>
        <option value="Youth Members">Youth Members</option> -->
      </select>
    </div>

    <!-- End Date -->
    <div>
      <label class="block text-gray-700 font-medium mb-1">Voting End Date</label>
      <input
        type="date"
        name="endDate"
        [(ngModel)]="proposal.endDate"
        required
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400" />
    </div>

    <!-- Submit Button -->
    <div class="flex justify-end pt-2">
      <button
        type="submit"
        [disabled]="!proposalForm.valid"
        class="bg-blue-700 hover:bg-blue-800 text-white px-5 py-2 rounded-md font-semibold text-sm transition">
        {{ editingProposal ? 'Save Changes' : 'Create Proposal' }}
      </button>
    </div>
  </form>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="mt-4 text-green-700 font-medium text-center text-sm">
    {{ successMessage }}
  </div>

  <!-- Proposal List -->
  <div *ngIf="proposals.length > 0" class="mt-8 space-y-6">
    <h2 class="text-lg font-bold text-gray-800 border-b pb-1">All Proposals</h2>

    <div class="grid gap-4 sm:grid-cols-2 md:grid-cols-3">
      <div *ngFor="let p of proposals" class="bg-white p-4 rounded-lg shadow border text-sm">
        <!-- Edit Mode -->
        <ng-container *ngIf="editingProposal?._id === p._id; else viewMode">
          <div class="space-y-3">
            <input [(ngModel)]="editingProposal.title" placeholder="Title" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-400" />
            <textarea [(ngModel)]="editingProposal.description" rows="2" placeholder="Description" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-400"></textarea>
            <input [(ngModel)]="editingProposal.eligibility" placeholder="Eligibility" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-400" />
            <input type="date" [(ngModel)]="editingProposal.endDate" class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-400" />
            <div class="flex justify-end gap-3 pt-2">
              <button (click)="updateProposal()" class="bg-green-600 text-white px-4 py-1.5 rounded-md hover:bg-green-700 font-semibold">Save</button>
              <button (click)="editingProposal = null" class="bg-gray-500 text-white px-4 py-1.5 rounded-md hover:bg-gray-600 font-semibold">Cancel</button>
            </div>
          </div>
        </ng-container>

        <!-- View Mode -->
        <ng-template #viewMode>
          <div class="space-y-1">
            <h3 class="font-bold text-gray-900">{{ p.title }}</h3>
            <p class="text-gray-700">{{ p.description }}</p>
            <p class="text-gray-500">Eligibility: <strong>{{ p.eligibility }}</strong></p>
            <p class="text-gray-500">Ends on: {{ p.endDate | date }}</p>
            <p class="text-gray-700 mt-2 font-medium">
              ✅ Yes: {{ p.yesVotes || 0 }} |  No: {{ p.noVotes || 0 }}
            </p>
            <div class="flex justify-between items-center pt-3 border-t mt-3">
              <button (click)="editProposal(p)" class="text-blue-700 hover:underline font-semibold">Edit</button>
              <button (click)="deleteProposal(p._id)" class="text-red-700 hover:underline font-semibold">Delete</button>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
